<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css?v=1.0.2">
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","width":260,"display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="JDBC概述JDBC简介 JDBC全称：Java DataBase Connectivity（java数据库连接） JDBC是SUN公司为了简化、统一对数据库的操作，定义了一套Java操作数据库的规范。 JDBC是一组专门负责连接并操作数据库的标准，在整个JDBC中提供了大量的接口，由数据库厂商提供，不同数据库的JDBC驱动程序不同。 JDBC与数据库驱动直接的关系：接口与实现的关系。">
<meta name="keywords" content="JDBC,MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="JDBC复习（全面）">
<meta property="og:url" content="https://Maggie720.github.io/2019/10/18/JDBC复习（全面）/index.html">
<meta property="og:site_name" content="Maggie&#39;s magic">
<meta property="og:description" content="JDBC概述JDBC简介 JDBC全称：Java DataBase Connectivity（java数据库连接） JDBC是SUN公司为了简化、统一对数据库的操作，定义了一套Java操作数据库的规范。 JDBC是一组专门负责连接并操作数据库的标准，在整个JDBC中提供了大量的接口，由数据库厂商提供，不同数据库的JDBC驱动程序不同。 JDBC与数据库驱动直接的关系：接口与实现的关系。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-04-11T08:48:52.514Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JDBC复习（全面）">
<meta name="twitter:description" content="JDBC概述JDBC简介 JDBC全称：Java DataBase Connectivity（java数据库连接） JDBC是SUN公司为了简化、统一对数据库的操作，定义了一套Java操作数据库的规范。 JDBC是一组专门负责连接并操作数据库的标准，在整个JDBC中提供了大量的接口，由数据库厂商提供，不同数据库的JDBC驱动程序不同。 JDBC与数据库驱动直接的关系：接口与实现的关系。">
  <link rel="canonical" href="https://Maggie720.github.io/2019/10/18/JDBC复习（全面）/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>JDBC复习（全面） | Maggie's magic</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Maggie's magic</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">学、思、践、悟</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
        
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      
    
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger">
        
          <i class="fa fa-search fa-fw"></i>
        
        搜索
        </a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://Maggie720.github.io/2019/10/18/JDBC复习（全面）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Maggie">
      <meta itemprop="description" content="It is never too late to learn.">
      <meta itemprop="image" content="/images/header.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Maggie's magic">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            JDBC复习（全面）
            

          
        </h1>

        <div class="post-meta">
		
		  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-10-18 19:28:14" itemprop="dateCreated datePublished" datetime="2019-10-18T19:28:14+08:00">2019-10-18</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-11 16:48:52" itemprop="dateModified" datetime="2020-04-11T16:48:52+08:00">2020-04-11</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JDBC/" itemprop="url" rel="index">
                    <span itemprop="name">JDBC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span>27k</span>
            </span>
          
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span>24 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="JDBC概述"><a href="#JDBC概述" class="headerlink" title="JDBC概述"></a>JDBC概述</h2><h3 id="JDBC简介"><a href="#JDBC简介" class="headerlink" title="JDBC简介"></a>JDBC简介</h3><ul>
<li>JDBC全称：Java DataBase Connectivity（java数据库连接）</li>
<li>JDBC是SUN公司为了简化、统一对数据库的操作，定义了一套Java操作数据库的规范。</li>
<li>JDBC是一组专门负责连接并操作数据库的标准，在整个JDBC中提供了大量的接口，由数据库厂商提供，不同数据库的JDBC驱动程序不同。</li>
<li>JDBC与数据库驱动直接的关系：接口与实现的关系。</li>
</ul>
<a id="more"></a>

<h3 id="JDBC操作的基本步骤"><a href="#JDBC操作的基本步骤" class="headerlink" title="JDBC操作的基本步骤"></a>JDBC操作的基本步骤</h3><ol>
<li>加载数据库驱动程序，加载的时候需要将驱动程序配置到classpath中</li>
<li>连接数据库，通过Connection接口和DriverManager类完成</li>
<li>操作数据库，通过Statement，PreparedStatement、ResultSet三个接口完成</li>
<li>关闭数据库，在实际开发中，数据库资源非常有限，操作完之后必须关闭。</li>
</ol>
<h2 id="JDBC的一个类和三个接口"><a href="#JDBC的一个类和三个接口" class="headerlink" title="JDBC的一个类和三个接口"></a>JDBC的一个类和三个接口</h2><h3 id="java-sql-DriverManager类（注册驱动和创建连接）"><a href="#java-sql-DriverManager类（注册驱动和创建连接）" class="headerlink" title="java.sql.DriverManager类（注册驱动和创建连接）"></a>java.sql.DriverManager类（注册驱动和创建连接）</h3><ol>
<li>注册驱动</li>
</ol>
<ul>
<li>法1</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DriverManager.registerDriver(<span class="keyword">new</span> com.mysql.jdbc.Driver());</span><br><span class="line"><span class="comment">//在mysql8.0版本以上： </span></span><br><span class="line">DriverManager.registerDriver(<span class="keyword">new</span> com.mysql.cj.jdbc.Driver());</span><br></pre></td></tr></table></figure>

<p>这种我们不推荐使用：一是导致驱动被注册两次，二是强烈依赖数据库的驱动jar包<br>com.mysql.jdbc.Driver类中有注册驱动的静态代码块，其中new Driver()会实例化一个当前的驱动</p>
<ul>
<li>法2</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);  </span><br><span class="line"><span class="comment">//在mysql8.0版本以上： </span></span><br><span class="line">Class.forName(<span class="string">"com.mysql.cj.jdbc.Driver"</span>);</span><br></pre></td></tr></table></figure>

<p>第二种是用Class.forName(“类名”)的，向虚拟机实例化一个Class实例，在com.mysql.jdbc.Driver类中有注册驱动的静态代码块，只要执行这条语句，就完成了驱动的注册。</p>
<ol start="2">
<li>与数据库建立连接</li>
</ol>
<blockquote>
<p>URL:SUN公司与数据库厂商之间的一种协议，下面是一个URL的对应解释<br>jdbc:mysql://localhost:3306/Test 　　　　　　<br>协议:子协议://     IP       :端口号/数据库名称</p>
</blockquote>
<ul>
<li>法1</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(String url)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">DriverManager.<span class="title">getConnection</span><span class="params">(<span class="string">"jdbc:mysql://localhost:3306/test?user=root&amp;password=root"</span>)</span></span>;</span><br><span class="line"><span class="comment">//mysql8.0版本以上：</span></span><br><span class="line">DriverManager.getConnection(<span class="string">"jdbc:mysql://localhost:3306/stus?useSSL=false&amp;serverTimezone=UTC&amp;user=root&amp;password=123456"</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>法2</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(String url, String user, String password)</span></span></span><br><span class="line"><span class="function">DriverManager.<span class="title">getConnection</span><span class="params">(<span class="string">"jdbc:mysql://localhost:3306/test"</span>, <span class="string">"root"</span>, <span class="string">"root"</span>)</span></span>;</span><br><span class="line"><span class="comment">//mysql8.0版本以上：</span></span><br><span class="line">Connection conn = DriverManager.getConnection(<span class="string">"jdbc:mysql://localhost:3306/stus?useSSL=false&amp;serverTimezone=UTC"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="java-sql-Connection接口（一个连接）"><a href="#java-sql-Connection接口（一个连接）" class="headerlink" title="java.sql.Connection接口（一个连接）"></a>java.sql.Connection接口（一个连接）</h3><p>接口的实现在数据库驱动中，所有与数据库交互都是基于连接对象的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Statement  <span class="title">createStatement</span><span class="params">()</span></span>; <span class="comment">//创建操作sql语句的对象</span></span><br><span class="line"><span class="function">PreparedStatement  <span class="title">prepareStatement</span><span class="params">(sql)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="java-sql-Statement接口-（操作sql语句，并返回相应结果的对象"><a href="#java-sql-Statement接口-（操作sql语句，并返回相应结果的对象" class="headerlink" title="java.sql.Statement接口:（操作sql语句，并返回相应结果的对象)"></a>java.sql.Statement接口:（操作sql语句，并返回相应结果的对象)</h3><p>接口的实现在数据库驱动中，用于执行静态 SQL 语句并返回它所生成结果的对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据查询语句返回结果集。只能执行select语句。  　　</span></span><br><span class="line"><span class="function">ResultSet <span class="title">executeQuery</span><span class="params">(String sql)</span> 　　</span></span><br><span class="line"><span class="function"><span class="comment">//根据执行的DML（insert update delete）语句，返回受影响的行数。 　　</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">executeUpdate</span><span class="params">(String sql)</span></span></span><br><span class="line"><span class="function"><span class="comment">//此方法可以执行任意sql语句。返回boolean值，表示是否返回ResultSet结果集。仅当执行select语句，且有返回结果时返回true, 其它语句都返回false。</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">execute</span><span class="params">(String sql)</span></span></span><br></pre></td></tr></table></figure>

<h3 id="java-sql-ResultSet接口-（结果集（客户端存表数据的对象））"><a href="#java-sql-ResultSet接口-（结果集（客户端存表数据的对象））" class="headerlink" title="java.sql.ResultSet接口:（结果集（客户端存表数据的对象））"></a>java.sql.ResultSet接口:（结果集（客户端存表数据的对象））</h3><p>1）封装结果集<br>提供一个游标，默认游标指向结果集第一行之前<br>调用一次next()，游标向下移动一行 　　　　<br>提供一些get方法</p>
<p>2）封装数据的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Object <span class="title">getObject</span><span class="params">(<span class="keyword">int</span> columnIndex)</span></span>; 　　根据序号取值，索引从<span class="number">1</span>开始</span><br><span class="line"><span class="function">Object <span class="title">getObject</span><span class="params">(String ColomnName)</span></span>; 　　根据列名取值</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">next</span><span class="params">()</span> 　　将光标从当前位置向下移动一行</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">(<span class="keyword">int</span> colIndex)</span> 　　　　 以<span class="keyword">int</span>形式获取ResultSet结果集当前行指定列号值</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getInt</span><span class="params">(String colLabel)</span>　　  以<span class="keyword">int</span>形式获取ResultSet结果集当前行指定列名值</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">getFloat</span><span class="params">(<span class="keyword">int</span> colIndex)</span> 　　以<span class="keyword">float</span>形式获取ResultSet结果集当前行指定列号值</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">getFloat</span><span class="params">(String colLabel)</span>　以<span class="keyword">float</span>形式获取ResultSet结果集当前行指定列名值</span></span><br><span class="line"><span class="function">String <span class="title">getString</span><span class="params">(<span class="keyword">int</span> colIndex)</span> 　以String 形式获取ResultSet结果集当前行指定列号值</span></span><br><span class="line"><span class="function">String <span class="title">getString</span><span class="params">(String colLabel)</span> 以String形式获取ResultSet结果集当前行指定列名值</span></span><br><span class="line"><span class="function">Date <span class="title">getDate</span><span class="params">(<span class="keyword">int</span> columnIndex)</span></span>;  </span><br><span class="line"><span class="function">Date <span class="title">getDate</span><span class="params">(String columnName)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> 　　关闭ResultSet 对象</span></span><br></pre></td></tr></table></figure>

<h2 id="细说JDBC连接过程"><a href="#细说JDBC连接过程" class="headerlink" title="细说JDBC连接过程"></a>细说JDBC连接过程</h2><p>连接数据库所需要的信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driverClass=com.mysql.cj.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://localhost:3306/bank?useSSL=false&amp;serverTimezone=UTC</span><br><span class="line">name=root</span><br><span class="line">password=123456</span><br></pre></td></tr></table></figure>

<h3 id="注册驱动"><a href="#注册驱动" class="headerlink" title="注册驱动"></a>注册驱动</h3><p>第一种：Class.forName(“com.mysql.cj.jdbc.Driver”);　　<br>第二种：DriverManager.register(new com,mysql.cj.jdbc.Driver());　　</p>
<p>1）什么是驱动</p>
<p><strong>驱动就是JDBC实现类</strong>，通俗点讲，就是能够连接到数据库功能的东西就是驱动，由于市面上有很多数据库，Oracle、MySql等等，所以<strong>java就有一个连接数据库的实现规范接口</strong>，定义一系列的连接数据库接口<strong>(java.sql.Driver接口)</strong>，<strong>但是不提供实现，而每个数据库厂家来提供这些接口的具体实现</strong>，这样一来，不管使用的是什么数据库，我们开发者写的代码都是相同的，就不必因为数据库的不同，而写法不同，唯一的不同就是数据库驱动不一样，使用mysql，那么就必须使用mysql的驱动，使用Oracle就必须使用oracle的驱动实现类。</p>
<p>2）DriverManager，一个工具类，是用于操作管理JDBC实现类的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">原始写法：DriverManager.register(<span class="keyword">new</span> Driver());　　<span class="comment">//因为使用的是MySql，所以在导包时就需要导入com.mysql.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line">现在写法：Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);　　<span class="comment">//不用导包，会执行com.mysql.jdbc.Driver类中的静态代码块，其静态代码块的内容为</span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;                      </span><br><span class="line">        java.sql.DriverManager.registerDriver(<span class="keyword">new</span> Driver());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException E) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Can't register driver!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分析：　</p>
<p>会发现第二种加载驱动的方法的底层其实就是第一种加载驱动。为什么要这样呢？原因很简单，　第一种是硬编程，直接将数据库驱动给写死了，无法扩展，如果使用第一种，那么连接的数据库只能是mysql，因为导包导的是mysql的驱动包，如果换成Oracle，就会报错，需要在代码中将Oracle的驱动包导入，这样很麻烦，而第二种写法就不一样了，<strong>第二种是使用的字符串方法注册驱动的，我们只需要将该字符串提取到一个配置文件中，以后想换成oracle数据库，只需要将该字符串换成oracle驱动的类全名即可,而不需要到代码中去修改什么东西。</strong></p>
<h3 id="获取（Connection）连接对象"><a href="#获取（Connection）连接对象" class="headerlink" title="获取（Connection）连接对象"></a>获取（Connection）连接对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">第一种：Connection conn = DriverManager.getConnection(url);</span><br><span class="line">第二种：Connection conn = DriverManager.getConnection(url,user,password);</span><br></pre></td></tr></table></figure>

<h3 id="获取Statement对象（执行sql语句对象）"><a href="#获取Statement对象（执行sql语句对象）" class="headerlink" title="获取Statement对象（执行sql语句对象）"></a>获取Statement对象（执行sql语句对象）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Statement st = conn.createStatement();　　<span class="comment">//获取sql语句执行对象</span></span><br><span class="line">st.excuteUpdate(sql);　　<span class="comment">//执行增删改语句</span></span><br><span class="line">st.excuteQuery(sql);　　 <span class="comment">//执行查询语句　</span></span><br><span class="line"></span><br><span class="line">PraparedStatment ps = conn.prapareStatement(sql);　　<span class="comment">//获取sql语句执行对象praparedStatment</span></span><br><span class="line"><span class="comment">//赋值</span></span><br><span class="line"><span class="comment">//可以设置很多中类型，index从1开始，代表sql语句中的第几个未知参数</span></span><br><span class="line">ps.setInt(Index,value);　　ps.setString(index,value);　　</span><br><span class="line">ps.excuteUpdate();　　  <span class="comment">//执行增删改语句</span></span><br><span class="line">ps.excuteQuery(sql);　　<span class="comment">//执行查询语句</span></span><br></pre></td></tr></table></figure>

<h3 id="执行SQL语句-获取结果集对象"><a href="#执行SQL语句-获取结果集对象" class="headerlink" title="执行SQL语句,获取结果集对象"></a>执行SQL语句,获取结果集对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行增删改的sql语句时，返回一个int类型的整数，代表数据库表影响的行数，</span></span><br><span class="line"><span class="keyword">int</span> count = ps.excuteUpdate();　　　</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行查询sql语句时，返回一个结果集对象，该对象装着所有查询到的数据信息，一行一行的存储数据库表信息。</span></span><br><span class="line">ResultSet rs = ps.executeQuery(sql);</span><br></pre></td></tr></table></figure>

<h3 id="如果有结果集（ResultSet），则处理结果集"><a href="#如果有结果集（ResultSet），则处理结果集" class="headerlink" title="如果有结果集（ResultSet），则处理结果集　"></a>如果有结果集（ResultSet），则处理结果集　</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">    <span class="comment">// 获取行数据的第一种方式</span></span><br><span class="line">    rs.getString(index);     <span class="comment">//index代表第几列，从1开始</span></span><br><span class="line">    <span class="comment">// 获取行数据的第二中方式</span></span><br><span class="line">    rs.getString(string);　　<span class="comment">//string：代表字段名称。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关闭连接，避免计算机资源消耗"><a href="#关闭连接，避免计算机资源消耗" class="headerlink" title="关闭连接，避免计算机资源消耗　"></a>关闭连接，避免计算机资源消耗　</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rs.close();</span><br><span class="line">stat.close();</span><br><span class="line">conn.close();</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>java的JDBC就分为5步，<br>4个属性<br>​    driver、url、user、password<br>五步：<br>​    注册驱动、获取连接、获取执行sql语句对象、获取结果集对象、处理结果。</p>
<h2 id="Statement和PrepareStatment"><a href="#Statement和PrepareStatment" class="headerlink" title="Statement和PrepareStatment"></a>Statement和PrepareStatment</h2><h3 id="关系与区别"><a href="#关系与区别" class="headerlink" title="关系与区别"></a>关系与区别</h3><p>　　关系：PreparedStatement继承自Statement,都是接口。<br>　　区别：PreparedStatement可以使用占位符，是预编译的，批处理比Statement效率高。sql语句可以不是完整的，可以将参数用?替代，然后在预编译后加入未知参数</p>
<h3 id="实例显示区别"><a href="#实例显示区别" class="headerlink" title="实例显示区别"></a>实例显示区别</h3><p>　　1）背景：有一个数据库，里面有个tb_users表，有id，name和passwd三列，然后按照给定的name和password值进行数据查询。</p>
<p>使用Statement查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sql=<span class="string">"select * from tb_users where name='"</span>+name+<span class="string">"' and passwd='"</span>+passwd+<span class="string">"'"</span>;</span><br><span class="line">Statement stmt=conn.createStatement();</span><br><span class="line">rs=stmt.executeQuery(sql);</span><br></pre></td></tr></table></figure>

<p>使用PrepareStatement查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sql=<span class="string">"select * from tb_users where username=? and userpwd=?"</span>;</span><br><span class="line">PreparedStatement pstmt=conn.prepareStatement(sql);</span><br><span class="line">pstmt.setString(<span class="number">1</span>,name);</span><br><span class="line">pstmt.setString(<span class="number">2</span>,passwd);</span><br><span class="line">rs=pstmt.executeQuery();</span><br></pre></td></tr></table></figure>

<p>　　2）有一个数据库表tb_books，包含id，name，author，price四列，向该表中插入数据。</p>
<p>使用Statement：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sql=<span class="string">"insert into tb_books(id,name,author,price) values('"</span>+id+<span class="string">"','"</span>+name+<span class="string">"',"</span>+author+<span class="string">",'"</span>+price+<span class="string">"')"</span>;</span><br><span class="line">Statement stmt = conn.createStatement();  </span><br><span class="line">stmt.executeUpdate(sql);</span><br></pre></td></tr></table></figure>

<p>使用PrepareStatement：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String sql=<span class="string">"insert into book(id,name,author,price) values (?,?,?,?)"</span>;  </span><br><span class="line">PreparedStatement pstmt = conn.prepareStatement(sql);  </span><br><span class="line">pstmt.setString(<span class="number">1</span>,var1);</span><br><span class="line">pstmt.setString(<span class="number">2</span>,var2);</span><br><span class="line">pstmt.setString(<span class="number">3</span>,var3);</span><br><span class="line">pstmt.setString(<span class="number">4</span>,var4);</span><br><span class="line">pstmt.executeUpdate();</span><br></pre></td></tr></table></figure>

<h3 id="PrepareStatement的优点"><a href="#PrepareStatement的优点" class="headerlink" title="PrepareStatement的优点"></a>PrepareStatement的优点</h3><p>　　1）PrepareStatement可以提高代码的可读性<br>　　2）ParperStatement提高了代码的灵活性和执行效率</p>
<p>PrepareStatement接口是Statement接口的子接口，他继承了Statement接口的所有功能。它主要是拿来解决我们使用Statement对象多次执行同一个SQL语句的效率问题的。 　　　 </p>
<p>ParperStatement接口的机制是在数据库支持预编译的情况下预先将SQL语句编译，当多次执行这条SQL语句时，可以直接执行编译好的SQL语句，这样就大大提高了程序的灵活性和执行效率。</p>
<p>　　3）使用PrepareStatement比Statement安全　</p>
<p>举例：用户登录时进行密码验证</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sql=<span class="string">"select * from tb_users where name= '"</span>+name+<span class="string">"' and passwd='"</span>+passwd+<span class="string">"'"</span>;</span><br><span class="line">stmt = conn.createStatement();  </span><br><span class="line">rs = stmt.executeUpdate(sql);</span><br></pre></td></tr></table></figure>

<p>上面是登录时进行用户名和密码的验证，但是当把‘’or ’1’=’’1’作为密码传递进去会发现如下的SQL语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username = <span class="string">'user'</span> and userpwd=<span class="string">''</span> or <span class="string">'1'</span>=<span class="string">'1'</span>;</span><br></pre></td></tr></table></figure>

<p>上面的SQL语句是个永真式。所以不管怎么样都能获取到权限，这还不是最坏的情况。<br>当把’or ‘1’=1’;drop table tb_book;当成密码传进去时，会直接删除数据库表，这样的SQL语句就非常的不安全。<br>所以使用PrepareStatement可以解决SQL注入攻击的问题</p>
<h2 id="JDBC工具类"><a href="#JDBC工具类" class="headerlink" title="JDBC工具类"></a>JDBC工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.uitl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> String driverClass = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> String url = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> String name = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> String password = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1. 创建一个属性配置对象</span></span><br><span class="line">            Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">            <span class="comment">//InputStream is = new FileInputStream("jdbc.properties");</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//使用类加载器，去读取src底下的资源文件。 后面在servlet</span></span><br><span class="line">            InputStream is = JDBCUtil.class.getClassLoader().getResourceAsStream(<span class="string">"jdbc.properties"</span>);</span><br><span class="line">            <span class="comment">//导入输入流。</span></span><br><span class="line">            properties.load(is);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//读取属性</span></span><br><span class="line">            driverClass = properties.getProperty(<span class="string">"driverClass"</span>);</span><br><span class="line">            url = properties.getProperty(<span class="string">"url"</span>);</span><br><span class="line">            name = properties.getProperty(<span class="string">"name"</span>);</span><br><span class="line">            password = properties.getProperty(<span class="string">"password"</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(driverClass);</span><br><span class="line">            <span class="comment">//静态代码块 ---&gt; 类加载了，就执行。 java.sql.DriverManager.registerDriver(new Driver());</span></span><br><span class="line">            <span class="comment">//DriverManager.registerDriver(new com.mysql.jdbc.Driver());</span></span><br><span class="line">            <span class="comment">//DriverManager.getConnection("jdbc:mysql://localhost/test?user=monty&amp;password=greatsqldb");</span></span><br><span class="line">            <span class="comment">//2. 建立连接 参数一： 协议 + 访问的数据库 ， 参数二： 用户名 ， 参数三： 密码。</span></span><br><span class="line">            conn = DriverManager.getConnection(url, name, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放资源</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> st</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rs</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(Connection conn, Statement st, ResultSet rs)</span> </span>&#123;</span><br><span class="line">        closeRs(rs);</span><br><span class="line">        closeSt(st);</span><br><span class="line">        closeConn(conn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(Connection conn, Statement st)</span> </span>&#123;</span><br><span class="line">        closeSt(st);</span><br><span class="line">        closeConn(conn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeRs</span><span class="params">(ResultSet rs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (rs != <span class="keyword">null</span>) &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rs = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeSt</span><span class="params">(Statement st)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (st != <span class="keyword">null</span>) &#123;</span><br><span class="line">                st.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            st = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeConn</span><span class="params">(Connection conn)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            conn = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JDBC处理MySQL中的TEXT数据"><a href="#JDBC处理MySQL中的TEXT数据" class="headerlink" title="JDBC处理MySQL中的TEXT数据"></a>JDBC处理MySQL中的TEXT数据</h2><p>TEXT数据是长文本数据，即CLOB（Character Large Object），使用CHAR来保存数据</p>
<h3 id="text类型也可以存储字符串"><a href="#text类型也可以存储字符串" class="headerlink" title="text类型也可以存储字符串"></a>text类型也可以存储字符串</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clobTest_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement pstmt = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        conn = JDBCUtil.getConn();</span><br><span class="line">        <span class="comment">//            String sql = "create table tb_clob_test(id int primary key auto_increment,clob_data text)";</span></span><br><span class="line">        String sql = <span class="string">"insert into tb_clob_test(clob_data)values(?)"</span>;</span><br><span class="line">        pstmt = conn.prepareStatement(sql);</span><br><span class="line">        pstmt.setString(<span class="number">1</span>, <span class="string">"hello world"</span>);</span><br><span class="line">        pstmt.execute();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        JDBCUtil.release(conn, pstmt, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数据的存入"><a href="#数据的存入" class="headerlink" title="数据的存入　"></a>数据的存入　</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数据只有ASCII，中文好像也可以</span></span><br><span class="line"><span class="comment">//InputStream is = new FileInputStream("java.txt");</span></span><br><span class="line"><span class="comment">//pstmt.setAsciiStream(1, is);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//数据包含中文字符或者其他特殊字符，以下两种都可以</span></span><br><span class="line"><span class="comment">//pstmt.setClob(1,new FileReader("java.txt"));</span></span><br><span class="line"><span class="comment">//pstmt.setCharacterStream(1,new FileReader("java.txt"));</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clobTest_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement pstmt = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        conn = JDBCUtil.getConn();</span><br><span class="line">        String sql = <span class="string">"insert into tb_clob_test(clob_data)values(?)"</span>;</span><br><span class="line">        pstmt = conn.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//数据只有ASCII，中文好像也可以</span></span><br><span class="line">        InputStream is = <span class="keyword">new</span> FileInputStream(<span class="string">"java.txt"</span>);</span><br><span class="line">        pstmt.setAsciiStream(<span class="number">1</span>, is);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//数据包含中文字符或者其他特殊字符，以下两种都可以</span></span><br><span class="line">        <span class="comment">//pstmt.setClob(1,new FileReader("java.txt"));</span></span><br><span class="line">        <span class="comment">//pstmt.setCharacterStream(1,new FileReader("java.txt"));</span></span><br><span class="line">        pstmt.execute();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        JDBCUtil.release(conn, pstmt, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数据的获取"><a href="#数据的获取" class="headerlink" title="数据的获取"></a>数据的获取</h3><ul>
<li>直接拿出字符流　</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clobSelectTest_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement pstmt = <span class="keyword">null</span>;</span><br><span class="line">    ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">    PrintWriter writer = <span class="keyword">null</span>;</span><br><span class="line">    BufferedReader bf = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        conn = JDBCUtil.getConn();</span><br><span class="line">        String sql = <span class="string">"select * from tb_clob_test where id = 6"</span>;</span><br><span class="line">        pstmt = conn.prepareStatement(sql);</span><br><span class="line">        rs = pstmt.executeQuery();</span><br><span class="line">        writer = <span class="keyword">new</span> PrintWriter(<span class="string">"java.txt.bak"</span>);</span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">            Reader reader = rs.getCharacterStream(<span class="number">2</span>);</span><br><span class="line">            bf = <span class="keyword">new</span> BufferedReader(reader);</span><br><span class="line">            String str = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">while</span> ((str=bf.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                writer.write(str);</span><br><span class="line">                writer.write(<span class="string">"\r\n"</span>);</span><br><span class="line">                writer.flush();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//pstmt.execute();</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bf.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            writer.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        JDBCUtil.release(conn, pstmt, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>拿出Clob，然后转化成字符流</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clobSelectTest_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement pstmt = <span class="keyword">null</span>;</span><br><span class="line">    ResultSet res = <span class="keyword">null</span>;</span><br><span class="line">    PrintWriter writer = <span class="keyword">null</span>;</span><br><span class="line">    BufferedReader bf = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        conn = JDBCUtil.getConn();</span><br><span class="line">        String sql = <span class="string">"select * from tb_clob_test where id = 6"</span>;</span><br><span class="line">        pstmt = conn.prepareStatement(sql);</span><br><span class="line">        res = pstmt.executeQuery();</span><br><span class="line">        writer = <span class="keyword">new</span> PrintWriter(<span class="string">"java.txt.bak"</span>);</span><br><span class="line">        <span class="keyword">while</span> (res.next()) &#123;</span><br><span class="line">            File file = <span class="keyword">new</span> File(<span class="string">"note_bak.txt"</span>);</span><br><span class="line">            FileWriter fw = <span class="keyword">new</span> FileWriter(file);</span><br><span class="line">            Clob clob = res.getClob(<span class="number">2</span>);</span><br><span class="line">            Reader reader = clob.getCharacterStream();</span><br><span class="line">            <span class="keyword">char</span>[] cs = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>((length = reader.read(cs))!=-<span class="number">1</span>)&#123;</span><br><span class="line">                fw.write(cs, <span class="number">0</span>, length);</span><br><span class="line">                fw.flush();</span><br><span class="line">            &#125;</span><br><span class="line">            fw.close();</span><br><span class="line">            reader.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//pstmt.execute();</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        JDBCUtil.release(conn, pstmt, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JDBC处理BLOB数据"><a href="#JDBC处理BLOB数据" class="headerlink" title="JDBC处理BLOB数据"></a>JDBC处理BLOB数据</h2><p>BLOB（binary large object）是二进制形式的长文本数据，使用二进制保存数据（如图片等）</p>
<h3 id="存储图片"><a href="#存储图片" class="headerlink" title="存储图片　"></a>存储图片　</h3><ul>
<li>方式1</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">blobInsert_1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement pstmt = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        conn = JDBCUtil.getConn();</span><br><span class="line">        <span class="comment">//            String sql = "create table tb_blob_test(id int primary key auto_increment,blob_data longblob)";</span></span><br><span class="line">        String sql = <span class="string">"insert into tb_blob_test(blob_data)values(?)"</span>;</span><br><span class="line">        pstmt = conn.prepareStatement(sql);</span><br><span class="line">        pstmt.setBinaryStream(<span class="number">1</span>,<span class="keyword">new</span> FileInputStream(<span class="string">"1.png"</span>));</span><br><span class="line">        <span class="keyword">boolean</span> execute = pstmt.execute();</span><br><span class="line">        System.out.println(execute);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        JDBCUtil.release(conn, pstmt, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>方式2</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">blobInsert_1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement pstmt = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        conn = JDBCUtil.getConn();</span><br><span class="line">        <span class="comment">//            String sql = "create table tb_blob_test(id int primary key auto_increment,blob_data longblob)";</span></span><br><span class="line">        String sql = <span class="string">"insert into tb_blob_test(blob_data)values(?)"</span>;</span><br><span class="line">        pstmt = conn.prepareStatement(sql);</span><br><span class="line">        pstmt.setBinaryStream(<span class="number">1</span>,<span class="keyword">new</span> FileInputStream(<span class="string">"1.png"</span>));</span><br><span class="line">        <span class="keyword">boolean</span> execute = pstmt.execute();</span><br><span class="line">        System.out.println(execute);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        JDBCUtil.release(conn, pstmt, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从数据库中读取图片"><a href="#从数据库中读取图片" class="headerlink" title="从数据库中读取图片"></a>从数据库中读取图片</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">blobReader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement pstmt = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        conn = JDBCUtil.getConn();</span><br><span class="line">        String sql = <span class="string">"select * from tb_blob_test where id =1"</span>;</span><br><span class="line">        pstmt = conn.prepareStatement(sql);</span><br><span class="line">        ResultSet rs = pstmt.executeQuery();</span><br><span class="line">        rs.next();</span><br><span class="line">        InputStream is = rs.getBinaryStream(<span class="number">2</span>);</span><br><span class="line">        OutputStream os = <span class="keyword">new</span> FileOutputStream(<span class="string">"blob.jpg"</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] bs = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> ((len=is.read(bs))!=-<span class="number">1</span>)&#123;</span><br><span class="line">            os.write(bs,<span class="number">0</span>,len);</span><br><span class="line">        &#125;</span><br><span class="line">        os.flush();</span><br><span class="line">        os.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">        JDBCUtil.release(conn, pstmt, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JDBC中设置事务的隔离级别"><a href="#JDBC中设置事务的隔离级别" class="headerlink" title="JDBC中设置事务的隔离级别"></a>JDBC中设置事务的隔离级别</h2><h3 id="在JDBC中一些基本的设置事务的操作"><a href="#在JDBC中一些基本的设置事务的操作" class="headerlink" title="在JDBC中一些基本的设置事务的操作　"></a>在JDBC中一些基本的设置事务的操作　</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MySQL设置事务隔离级别，一般不会再JDBC代码中设置，会直接在MySQL服务器中去设置</span></span><br><span class="line">conn.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ);</span><br><span class="line"><span class="comment">//在JDBC设置手动提交事务</span></span><br><span class="line">conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line"><span class="comment">//设置回滚点</span></span><br><span class="line">sp = conn.setSavepoint();</span><br><span class="line"><span class="comment">//事务回滚</span></span><br><span class="line">conn.rollback(sp);</span><br></pre></td></tr></table></figure>

<h3 id="事务处理具体实例"><a href="#事务处理具体实例" class="headerlink" title="事务处理具体实例"></a>事务处理具体实例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tx_test_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement pstmt = <span class="keyword">null</span>;</span><br><span class="line">    ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">    Savepoint sp = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        conn = JDBCUtil.getConn();</span><br><span class="line">        <span class="comment">// MySQL设置事务隔离级别，一般不会再JDBC代码中设置，会直接在MySQL服务器中去设置</span></span><br><span class="line">        conn.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ);</span><br><span class="line">        <span class="comment">// 在JDBC设置手动提交事务</span></span><br><span class="line">        conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// 在转账的时候，先判断源账号的余额是否大于转账金额</span></span><br><span class="line">        <span class="comment">// 判断之前先查询源账户的余额</span></span><br><span class="line">        String sql0 = <span class="string">"select money from account where id =2"</span>;</span><br><span class="line">        pstmt = conn.prepareStatement(sql0);</span><br><span class="line">        rs = pstmt.executeQuery();</span><br><span class="line">        <span class="keyword">int</span> balance = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">            balance = rs.getInt(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 转账金额</span></span><br><span class="line">        <span class="keyword">int</span> much = <span class="number">1000</span>;</span><br><span class="line">        <span class="comment">// 判断余额是否大于转账金额</span></span><br><span class="line">        <span class="keyword">if</span> (balance &lt; much) &#123;</span><br><span class="line">            JDBCUtil.release(conn, pstmt, rs);</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sp = conn.setSavepoint();</span><br><span class="line">        <span class="comment">// 张三的余额减去1000</span></span><br><span class="line">        String sql1 = <span class="string">"update account set money=money-1000 where id=2"</span>;</span><br><span class="line">        pstmt = conn.prepareStatement(sql1);</span><br><span class="line">        pstmt.executeUpdate();</span><br><span class="line">        <span class="comment">// 李四的余额加上1000</span></span><br><span class="line">        String sql2 = <span class="string">"update account set money=money+1000 where id=1"</span>;</span><br><span class="line">        <span class="comment">//            pstmt.executeUpdate(sql2);这是调用父类的方法一样可以</span></span><br><span class="line">        pstmt = conn.prepareStatement(sql2);</span><br><span class="line">        pstmt.executeUpdate();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//                conn.rollback();</span></span><br><span class="line">            conn.rollback(sp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">            e1.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.rollback();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        JDBCUtil.release(conn, pstmt, rs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数据库元数据的查看"><a href="#数据库元数据的查看" class="headerlink" title="数据库元数据的查看"></a>数据库元数据的查看</h2><ul>
<li><p>前言：前面使用JDBC来处理数据库的接口主要有三个，即Connection，PreparedStatement和ResultSet这三个，而对于这三个接口，还可以获取不同类型的元数据，通过这些元数据类获得一些数据库的信息。</p>
</li>
<li><p><strong>元数据(MetaData)</strong>，<strong>即定义数据的数据</strong>。打个比方，就好像我们要想搜索一首歌(歌本身是数据)，而我们可以通过歌名，作者，专辑等信息来搜索，那么这些歌名，作者，专辑等等就是这首歌的元数据。因此数据库的元数据就是一些注明数据库信息的数据。</p>
</li>
</ul>
<p>① 由Connection对象的getMetaData()方法获取的是DatabaseMetaData对象。<br>② 由PreparedStatement对象的getParameterMetaData ()方法获取的是ParameterMetaData对象。<br>③ 由ResultSet对象的getMetaData()方法获取的是ResultSetMetaData对象。</p>
<h3 id="DatabaseMetaData"><a href="#DatabaseMetaData" class="headerlink" title="DatabaseMetaData　"></a>DatabaseMetaData　</h3><p>DatabaseMetaData是由Connection对象通过getMetaData方法获取而来，主要封装了是对数据库本身的一些整体综合信息。<br>例如数据库的产品名称，数据库的版本号，数据库的URL，是否支持事务等等，能获取的信息比较多，具体可以参考DatabaseMetaData的API文档。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查看当前连接中有关MySQL的系统信息，比如版本号，是否支持事务，数据库名字。</span></span><br><span class="line">DatabaseMetaData data = conn.getMetaData(); </span><br><span class="line"></span><br><span class="line">以下有一些关于DatabaseMetaData的常用方法：</span><br><span class="line">　　·getDatabaseProductName：获取数据库的产品名称</span><br><span class="line">　　·getDatabaseProductName：获取数据库的版本号</span><br><span class="line">　　·getUserName：获取数据库的用户名</span><br><span class="line">　　·getURL：获取数据库连接的URL</span><br><span class="line">　　·getDriverName：获取数据库的驱动名称</span><br><span class="line">　　·getDriverVersion：获取数据库的驱动版本号</span><br><span class="line">　　·isReadOnly：查看数据库是否只允许读操作</span><br><span class="line">　　·supportsTransactions：查看数据库是否支持事务</span><br></pre></td></tr></table></figure>

<h3 id="ParameterMetaData"><a href="#ParameterMetaData" class="headerlink" title="ParameterMetaData"></a>ParameterMetaData</h3><p>ParameterMetaData是由PreparedStatement对象通过getParameterMetaData方法获取而来，主要是针对PreparedStatement对象和其预编译的SQL命令语句提供一些信息。</p>
<p>比如像”insert into account(id,name,money) values(?,?,?)”这样的预编译SQL语句，ParameterMetaData能提供占位符参数的个数，获取指定位置占位符的SQL类型等等，详细请看有关ParameterMetaData的API文档</p>
<ul>
<li>常用方法：</li>
</ul>
<p>getParameterCount：获取预编译SQL语句中占位符参数的个数<br>在我看来，ParameterMetaData对象能用的只有获取参数个数的getParameterCount()方法。<br>注意：ParameterMetaData许多方法MySQL并不友好支持，比如像获取指定参数的SQL类型的getParameterType方法，如果数据库驱动连接URL只是简单的“jdbc:mysql://localhost:3306/jdbcdemo”那么MyEclipse会抛出SQLException异常，必须要将URL修改为“jdbc:mysql://localhost:3306/jdbcdemo?generateSimpleParameterMetadata=true”才行。但是像getParameterType等等与其他的方法也没多好用，因为如下面的例子，这些方法好像只会将所有的参数认为是字符串(VARCHAR)类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testParameterMetaData</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement st = <span class="keyword">null</span>;</span><br><span class="line">    ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        conn = JdbcUtils.getConnection();</span><br><span class="line">        String sql = <span class="string">"insert into user(id,name,age) values(?,?,?)"</span>;</span><br><span class="line">        st = conn.prepareStatement(sql);</span><br><span class="line">        st.setInt(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        st.setString(<span class="number">2</span>, <span class="string">"Ding"</span>);</span><br><span class="line">        st.setInt(<span class="number">3</span>, <span class="number">25</span>);</span><br><span class="line"></span><br><span class="line">        ParameterMetaData paramMetaData = st.getParameterMetaData();</span><br><span class="line">        <span class="comment">//获取参数个数</span></span><br><span class="line">        <span class="keyword">int</span> paramCount = paramMetaData.getParameterCount();</span><br><span class="line">        <span class="comment">//以字符串形式获取指定参数的SQL类型，这里有问题</span></span><br><span class="line">        String paramTypeName = paramMetaData.getParameterTypeName(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//返回指定参数的SQL类型，以java.sql.Types类的字段表示，这里有问题</span></span><br><span class="line">        <span class="keyword">int</span> paramType = paramMetaData.getParameterType(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//返回指定参数类型的Java完全限定名称，这里有问题</span></span><br><span class="line">        String paramClassName = paramMetaData.getParameterClassName(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//返回指定参数的模，这里有问题</span></span><br><span class="line">        <span class="keyword">int</span> paramMode = paramMetaData.getParameterMode(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//返回指定参数的列大小，这里有问题</span></span><br><span class="line">        <span class="keyword">int</span> precision = paramMetaData.getPrecision(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//返回指定参数的小数点右边的位数，这里有问题</span></span><br><span class="line">        <span class="keyword">int</span> scale = paramMetaData.getScale(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结：</strong>因此在以后使用参数元数据ParameterMetaData尽量只要使用其getParamterCount()方法获取参数个数，对于该对象其他方法请慎用。</p>
<h3 id="ResultSetMetaData"><a href="#ResultSetMetaData" class="headerlink" title="ResultSetMetaData"></a>ResultSetMetaData</h3><p>ResultSetMetaData是由ResultSet对象通过getMetaData方法获取而来，主要是针对由数据库执行的SQL脚本命令获取的结果集对象ResultSet中提供的一些信息。</p>
<p>比如结果集中的列数、指定列的名称、指定列的SQL类型等等，可以说这个是对于框架来说非常重要的一个对象。关于该结果集元数据对象的其他具体功能和方法请查阅有关ResultSetMetaData的API文档。　</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">以下有一些关于ResultSetMetaData的常用方法：</span><br><span class="line">　　·getColumnCount：获取结果集中列项目的个数</span><br><span class="line">　　·getColumnType：获取指定列的SQL类型对应于Java中Types类的字段</span><br><span class="line">　　·getColumnTypeName：获取指定列的SQL类型</span><br><span class="line">　　·getClassName：获取指定列SQL类型对应于Java中的类型(包名加类名)</span><br></pre></td></tr></table></figure>

<p> <strong>实例展示：</strong></p>
<ul>
<li>数据表　</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">40</span>),</span><br><span class="line">    age <span class="built_in">int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(<span class="keyword">id</span>,<span class="keyword">name</span>,age) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'Ding'</span>,<span class="number">25</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(<span class="keyword">id</span>,<span class="keyword">name</span>,age) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">'LRR'</span>,<span class="number">24</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>测试</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testResultSetMetaData</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    PreparedStatement st = <span class="keyword">null</span>;</span><br><span class="line">    ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        conn = JdbcUtils.getConnection();</span><br><span class="line">        String sql = <span class="string">"select * from user"</span>;</span><br><span class="line">        st = conn.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">        rs = st.executeQuery();</span><br><span class="line">        ResultSetMetaData resultMetaData = rs.getMetaData();</span><br><span class="line">        <span class="comment">//获取结果集的列数</span></span><br><span class="line">        <span class="keyword">int</span> columnCount = resultMetaData.getColumnCount();</span><br><span class="line">        <span class="comment">//获取指定列的名称</span></span><br><span class="line">        String columnName = resultMetaData.getColumnName(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//获取指定列的SQL类型对应于java.sql.Types类的字段</span></span><br><span class="line">        <span class="keyword">int</span> columnType = resultMetaData.getColumnType(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//获取指定列的SQL类型</span></span><br><span class="line">        String columnTypeName = resultMetaData.getColumnTypeName(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//获取指定列SQL类型对应于Java的类型</span></span><br><span class="line">        String className= resultMetaData.getColumnClassName(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//获取指定列所在的表的名称</span></span><br><span class="line">        String tableName = resultMetaData.getTableName(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h2><ul>
<li>问题：</li>
</ul>
<p>我们在进行CRUD时，一直重复性的写一些代码，比如最开始的注册驱动，获取连接代码，一直重复写，通过编写一个获取连接的工具类后，解决了这个问题，但是又会出现新的问题，每进行一次操作，就会获取一个连接，用完之后，就销毁，就这样一直新建连接，销毁连接，新建，销毁，连接Connection 创建与销毁 比较耗时的。所以应该要想办法解决这个问题？</p>
<ul>
<li>解决方法：</li>
</ul>
<p>连接池就是为了解决这个问题而出现的一个方法，为了提高性能，开发连接池，连接池中一直保持有n个连接，供调用者使用，调用者用完返还给连接池，继续给别的调用使用，比如连接池中一开始就有10个连接，当有5个用户拿走了5个连接后，池中还剩5个，当第6个用户在去池中拿连接而前面5个连接还没归还时，连接池就会新建一个连接给第六个用户，让池中一直能够保存最少5个连接，而当这样新建了很多连接后，用户归还连接回来时，会比原先连接池中的10个连接更多，连接池就会设置一个池中最大空闲的连接数，如果超过了这个数，就会将超过的连接给释放掉，连接池就是这样工作的。</p>
<h3 id="连接池概述"><a href="#连接池概述" class="headerlink" title="连接池概述"></a>连接池概述</h3><p>数据库连接池负责<strong>分配、管理和释放</strong>数据库连接，它允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个；释放空闲时间超过最大空闲时间的数据库连接来避免因为没有释放数据库连接而引起的数据库连接遗漏。这项技术能明显提高对数据库操作的性能。</p>
<h3 id="比较应用程序直接获取连接和使用连接池"><a href="#比较应用程序直接获取连接和使用连接池" class="headerlink" title="比较应用程序直接获取连接和使用连接池"></a>比较应用程序直接获取连接和使用连接池</h3><ol>
<li><p>应用程序直接获取连接</p>
<p>缺点：用户每次请求都需要向数据库获得链接，而数据库创建连接通常需要消耗相对较大的资源，创建时间也较长。<br>假设网站一天10万访问量，数据库服务器就需要创建10万次连接，极大的浪费数据库的资源，并且极易造成数据库服务器内存溢出、宕机。</p>
</li>
<li><p>使用连接池连接</p>
<p>目的：解决建立数据库连接耗费资源和时间很多的问题，提高性能。</p>
</li>
</ol>
<h2 id="常用的数据库连接池"><a href="#常用的数据库连接池" class="headerlink" title="常用的数据库连接池　　"></a>常用的数据库连接池　　</h2><p>现在很多WEB服务器(Weblogic, WebSphere, Tomcat)都提供了<strong>DataSoruce的实现，即连接池的实现</strong>。通常我们<strong>把DataSource的实现，按其英文含义称之为数据源</strong>，</p>
<p>数据源中都包含了数据库连接池的实现。也有一些开源组织提供了数据源的独立实现：</p>
<p>DBCP 数据库连接池<br>C3P0 数据库连接池  </p>
<p>实际应用时不需要编写连接数据库代码，直接从数据源获得数据库的连接。程序员编程时也应尽量使用这些数据源的实现，以提升程序的数据库访问性能。</p>
<p>DBCP、C3P0、tomcat内置连接池(JNDI)是我们开发中会用到的。</p>
<p>数据库连接池主要完成数据库的连接，示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//静态代码块创建连接池，DataSource</span></span><br><span class="line"><span class="keyword">static</span> ComboPooledDataSource dataSource = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line">    dataSource = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取连接对象</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> SQLException </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConn</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dataSource.getConnection();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 释放资源,代码略</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(Connection conn , Statement st , ResultSet rs)</span></span></span><br></pre></td></tr></table></figure>

<h2 id="DbUtils"><a href="#DbUtils" class="headerlink" title="DbUtils"></a>DbUtils</h2><p>commons-dbutils 是 Apache 组织提供的一个开源 JDBC工具类库</p>
<p>常用API：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.apache.commons.dbutils.QueryRunner --- 核心</span><br><span class="line">org.apache.commons.dbutils.ResultSetHandler --- 结果集封装器</span><br><span class="line">org.apache.commons.dbutils.DbUtils --- 工具类</span><br></pre></td></tr></table></figure>

<h3 id="QueryRunner类"><a href="#QueryRunner类" class="headerlink" title="QueryRunner类"></a>QueryRunner类</h3><blockquote>
<p>构造方法：QueryRunner(DataSource ds)</p>
</blockquote>
<p>若使用C3P0连接池，可以通过连接池建立连接，用作后续的数据库CRUD等操作，代码如下：</p>
<blockquote>
<p>QueryRunner queryRunner = new QueryRunner(new ComboPooledDataSourse());</p>
</blockquote>
<p>增删改操作：</p>
<blockquote>
<p>queryRunner.update(String sql, Object… params);<br>前面是sql语句，后面是参数，即sql语句中的？,例如：<br>queryRunner.update(“insert into account(id,name,money)  values(null,?,?)”, “zhangsan”,1000);</p>
</blockquote>
<p>查询操作：</p>
<blockquote>
<p>queryRunner.query(String sql, Object… params);</p>
</blockquote>
<h3 id="ResultSetHandler接口"><a href="#ResultSetHandler接口" class="headerlink" title="ResultSetHandler接口"></a>ResultSetHandler接口</h3><p>该接口用于处理 java.sql.ResultSet，将获取的数据按要求转换为另一种形式</p>
<p>ResultSetHandler接口有很多的实现类，所以一般在用接口的时候，直接选择new一个实现类，调用相关方法。</p>
<blockquote>
<p>BeanHandler可以返回一个对象的信息<br> BeanListHandler可以返回多个对象的信息，并且用list集合封装。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询单个对象</span></span><br><span class="line">Account account=queryRunner.query（<span class="string">"select*from account where id=？"</span>，<span class="keyword">new</span> BeanHandler&lt;Account&gt;（Account.class），<span class="number">8</span>）；System.out.println(（)account.tostring())；</span><br><span class="line"><span class="comment">// 查询多个对象</span></span><br><span class="line"><span class="comment">/*List&lt;Account&gt;list=queryRunner.query（"select*from account"，new BeanListHandler&lt;Account&gt;（Account.class））；for（Account account:list）&#123;</span></span><br><span class="line"><span class="comment">system.out.print1n（account.tostring（））；</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line">字节码的用途：反射得到实例</span><br><span class="line"><span class="comment">// 通过类的字节码得到该类的实例</span></span><br><span class="line">Account a = <span class="keyword">new</span> Account（）;</span><br><span class="line"><span class="comment">// 创建一个类的实例</span></span><br><span class="line">Account a1 = Account.class.newInstance();</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
	
	<div>
	  
		<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
	  
	</div>
        
      
        <div class="reward-container">
  <div>您的支持将鼓励我继续创作分享！</div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
        
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Maggie 微信支付">
        <p>微信支付</p>
      </div>
        
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Maggie 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

      
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Maggie
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://Maggie720.github.io/2019/10/18/JDBC复习（全面）/" title="JDBC复习（全面）">https://Maggie720.github.io/2019/10/18/JDBC复习（全面）/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/JDBC/" rel="tag"><i class="fa fa-tag"></i># JDBC</a>
            
              <a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag"></i># MySQL</a>
            
          </div>
        

        

      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#JDBC概述"><span class="nav-number">1.</span> <span class="nav-text">JDBC概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JDBC简介"><span class="nav-number">1.1.</span> <span class="nav-text">JDBC简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JDBC操作的基本步骤"><span class="nav-number">1.2.</span> <span class="nav-text">JDBC操作的基本步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JDBC的一个类和三个接口"><span class="nav-number">2.</span> <span class="nav-text">JDBC的一个类和三个接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#java-sql-DriverManager类（注册驱动和创建连接）"><span class="nav-number">2.1.</span> <span class="nav-text">java.sql.DriverManager类（注册驱动和创建连接）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java-sql-Connection接口（一个连接）"><span class="nav-number">2.2.</span> <span class="nav-text">java.sql.Connection接口（一个连接）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java-sql-Statement接口-（操作sql语句，并返回相应结果的对象"><span class="nav-number">2.3.</span> <span class="nav-text">java.sql.Statement接口:（操作sql语句，并返回相应结果的对象)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java-sql-ResultSet接口-（结果集（客户端存表数据的对象））"><span class="nav-number">2.4.</span> <span class="nav-text">java.sql.ResultSet接口:（结果集（客户端存表数据的对象））</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#细说JDBC连接过程"><span class="nav-number">3.</span> <span class="nav-text">细说JDBC连接过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注册驱动"><span class="nav-number">3.1.</span> <span class="nav-text">注册驱动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取（Connection）连接对象"><span class="nav-number">3.2.</span> <span class="nav-text">获取（Connection）连接对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取Statement对象（执行sql语句对象）"><span class="nav-number">3.3.</span> <span class="nav-text">获取Statement对象（执行sql语句对象）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行SQL语句-获取结果集对象"><span class="nav-number">3.4.</span> <span class="nav-text">执行SQL语句,获取结果集对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如果有结果集（ResultSet），则处理结果集"><span class="nav-number">3.5.</span> <span class="nav-text">如果有结果集（ResultSet），则处理结果集　</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关闭连接，避免计算机资源消耗"><span class="nav-number">3.6.</span> <span class="nav-text">关闭连接，避免计算机资源消耗　</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">3.7.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Statement和PrepareStatment"><span class="nav-number">4.</span> <span class="nav-text">Statement和PrepareStatment</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#关系与区别"><span class="nav-number">4.1.</span> <span class="nav-text">关系与区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实例显示区别"><span class="nav-number">4.2.</span> <span class="nav-text">实例显示区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PrepareStatement的优点"><span class="nav-number">4.3.</span> <span class="nav-text">PrepareStatement的优点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JDBC工具类"><span class="nav-number">5.</span> <span class="nav-text">JDBC工具类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JDBC处理MySQL中的TEXT数据"><span class="nav-number">6.</span> <span class="nav-text">JDBC处理MySQL中的TEXT数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#text类型也可以存储字符串"><span class="nav-number">6.1.</span> <span class="nav-text">text类型也可以存储字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据的存入"><span class="nav-number">6.2.</span> <span class="nav-text">数据的存入　</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据的获取"><span class="nav-number">6.3.</span> <span class="nav-text">数据的获取</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JDBC处理BLOB数据"><span class="nav-number">7.</span> <span class="nav-text">JDBC处理BLOB数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#存储图片"><span class="nav-number">7.1.</span> <span class="nav-text">存储图片　</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从数据库中读取图片"><span class="nav-number">7.2.</span> <span class="nav-text">从数据库中读取图片</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JDBC中设置事务的隔离级别"><span class="nav-number">8.</span> <span class="nav-text">JDBC中设置事务的隔离级别</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#在JDBC中一些基本的设置事务的操作"><span class="nav-number">8.1.</span> <span class="nav-text">在JDBC中一些基本的设置事务的操作　</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务处理具体实例"><span class="nav-number">8.2.</span> <span class="nav-text">事务处理具体实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库元数据的查看"><span class="nav-number">9.</span> <span class="nav-text">数据库元数据的查看</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DatabaseMetaData"><span class="nav-number">9.1.</span> <span class="nav-text">DatabaseMetaData　</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ParameterMetaData"><span class="nav-number">9.2.</span> <span class="nav-text">ParameterMetaData</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ResultSetMetaData"><span class="nav-number">9.3.</span> <span class="nav-text">ResultSetMetaData</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库连接池"><span class="nav-number">10.</span> <span class="nav-text">数据库连接池</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#连接池概述"><span class="nav-number">10.1.</span> <span class="nav-text">连接池概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#比较应用程序直接获取连接和使用连接池"><span class="nav-number">10.2.</span> <span class="nav-text">比较应用程序直接获取连接和使用连接池</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常用的数据库连接池"><span class="nav-number">11.</span> <span class="nav-text">常用的数据库连接池　　</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DbUtils"><span class="nav-number">12.</span> <span class="nav-text">DbUtils</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#QueryRunner类"><span class="nav-number">12.1.</span> <span class="nav-text">QueryRunner类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ResultSetHandler接口"><span class="nav-number">12.2.</span> <span class="nav-text">ResultSetHandler接口</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/header.jpg"
      alt="Maggie">
  <p class="site-author-name" itemprop="name">Maggie</p>
  <div class="site-description" itemprop="description">It is never too late to learn.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">1</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/Maggie720" title="GitHub &rarr; https://github.com/Maggie720" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:1293386086@qq.com" title="Email &rarr; mailto:1293386086@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>Email</a>
      </span>
    
  </div>
  <div class="cc-license motion-element" itemprop="license">
    
  
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  &copy; 2019 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Maggie</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">27k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">24 分钟</span>
</div>



        












        
      </div>
    </footer>
  </div>

  
    
  
  <script color='255,51,51' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/pisces.js?v=7.4.1"></script>

<script src="/js/next-boot.js?v=7.4.1"></script>



  








  <script src="/js/local-search.js?v=7.4.1"></script>














  

  <!-- 页面点击心形 -->
  <script type="text/javascript" src="/js/clicklove.js"></script>
  

  

  
  
  
</body>
</html>
